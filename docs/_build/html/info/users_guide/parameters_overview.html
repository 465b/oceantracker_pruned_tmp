
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Parameters overview &#8212; OceanTracker Beta 0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Parameter details" href="../parameter_ref/parameter_ref_toc.html" />
    <link rel="prev" title="Running OceanTracker" href="running_ocean_tracker.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/ocean_tracker.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=oceantracker&repo=oceantracker&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demos/demos.html">Demos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../users_guide.html">Users guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing.html">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_ocean_tracker.html">Running OceanTracker</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Parameters overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#top-level-params">Top level params</a></li>
<li class="toctree-l3"><a class="reference internal" href="#case-level-params">Case level params</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defaults">Defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking">Checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-name-parameter">class_name parameter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../parameter_ref/parameter_ref_toc.html">Parameter details</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_files.html">Output files</a></li>
<li class="toctree-l2"><a class="reference internal" href="post_processing.html">Post processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../change_log.html">Change log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../future_dev.html">Future development</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../users_guide.html">Users guide</a><ul>
      <li>Previous: <a href="running_ocean_tracker.html" title="previous chapter">Running OceanTracker</a></li>
      <li>Next: <a href="../parameter_ref/parameter_ref_toc.html" title="next chapter">Parameter details</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="parameters-overview">
<span id="parameter-overview"></span><h1>Parameters overview<a class="headerlink" href="#parameters-overview" title="Permalink to this headline">¶</a></h1>
<p>OceanTracker is structured to run one more “cases” of particle tracking, each with their own set of parameters.
The parameters are a python dictionary of key-value pairs
(parameters  in JSON or Yaml file  are converted to a python dictionary).
Thus key-value pairs of parameters setup the computations. The top level parameter dictionary, may contain other nested parameter dictionaries, or lists of other parameter dictionaries.</p>
<p>Full details are at  <a class="reference internal" href="../parameter_ref/parameter_ref_toc.html#parameter-details"><span class="std std-ref">Parameter details</span></a></p>
<section id="top-level-params">
<h2>Top level params<a class="headerlink" href="#top-level-params" title="Permalink to this headline">¶</a></h2>
<p>The top level parameter dictionary has the structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>   <span class="s1">&#39;shared_params&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;root_output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;my_output&#39;</span><span class="p">,</span> <span class="o">....</span> <span class="p">}</span> <span class="c1"># common to all cases</span>
    <span class="s1">&#39;reader&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;class_name&#39;</span><span class="p">:,</span><span class="o">....</span> <span class="p">}</span> <span class="p">,</span>           <span class="c1"># shared hindcast reader</span>
    <span class="s1">&#39;base_case_params&#39;</span><span class="p">:</span> <span class="p">{},</span>                     <span class="c1"># user given defaults for all cases</span>
    <span class="s1">&#39;case_list&#39;</span><span class="p">:</span> <span class="p">[],</span>                            <span class="c1"># list of individual case parameters</span>
 <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>‘shared_params’ are parameters used  for all cases</p></li>
<li><p>‘reader’ are parameters for the hindcast reader, which reads variables from a set of hindcast files and is shared by all cases, eg input_dir and file_mask</p></li>
<li><p>‘base_case_params’ are parameters common to all cases,</p></li>
<li><p>‘case_list’ are parameters unique to each individual case which will also overwrite any also given in base_case_params.</p></li>
</ul>
<p>For single case parameter tracking, the user only needs to set ‘base_case_params’.
OceanTracker will automatically create a case with these parameters. A case list allows multiple cases to be run at the same time. Theses case will be run in
in parallel if shared_param ‘processors’ &gt; 1, otherwise they will run in serial.</p>
</section>
<section id="case-level-params">
<h2>Case level params<a class="headerlink" href="#case-level-params" title="Permalink to this headline">¶</a></h2>
<p>Both ‘base_case_params’ and those within the ‘case_list’  have the exactly the  same parameter structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>    <span class="s1">&#39;run_params&#39;</span> <span class="p">:</span> <span class="p">{}</span>
    <span class="c1"># core classes</span>
   <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">{},</span>
   <span class="s1">&#39;field_group_manager&#39;</span><span class="p">:{}</span> <span class="p">,</span>
   <span class="s1">&#39;interpolator&#39;</span><span class="p">:</span> <span class="p">{}</span> <span class="p">,</span>
   <span class="s1">&#39;particle_group_manager&#39;</span><span class="p">:</span> <span class="p">{},</span>
   <span class="s1">&#39;tracks_writer&#39;</span><span class="p">:</span>   <span class="p">{},</span>
   <span class="s1">&#39;dispersion&#39;</span><span class="p">:</span>      <span class="p">{},</span>
   <span class="s1">&#39;particle_release_groups&#39;</span><span class="p">:</span>  <span class="p">[],</span>  <span class="c1"># required</span>
 <span class="c1"># below are optional user classes held in named lists</span>
   <span class="s1">&#39;fields&#39;</span><span class="p">:</span>          <span class="p">[],</span>  <span class="c1"># prop calculated from other fields  on reading</span>
   <span class="s1">&#39;particle_properties&#39;</span><span class="p">:</span>     <span class="p">[],</span> <span class="c1"># user added particle properties, eg DistanceTraveled</span>
   <span class="s1">&#39;velocity_modifiers&#39;</span><span class="p">:</span>      <span class="p">[],</span> <span class="c1"># user added velocity effects, eg TerminalVelocity</span>
   <span class="s1">&#39;trajectory_modifiers&#39;</span><span class="p">:</span>    <span class="p">[],</span> <span class="c1"># change particle paths, eg. re-suspension</span>
   <span class="s1">&#39;particle_statistics&#39;</span><span class="p">:</span> <span class="p">[],</span><span class="c1"># heat map inside polygon statitics calculated on the fly</span>
   <span class="s1">&#39;event_loggers&#39;</span><span class="p">:</span>           <span class="p">[],</span> <span class="c1"># writes events files ,eg PolygonEntryExit</span>
   <span class="s1">&#39;particle_concentrations&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="c1"># writes concentration of particles within triangles of the grid</span>
                                   <span class="c1"># and other properties calculated on the fly.   files ,eg PolygonEntryExit</span>
   <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>‘run_params’ are case  specific parameters, eg ‘duration’</p></li>
<li><p>the next block are core classes  parameters, eg set turbulent eddy viscosity in random walk ‘dispersion’</p></li>
<li><p>‘particle_release_groups’ is required. It  is a list of parameters detailing where and when particles are released from points or within a polygon. The list allows particles from  each release group to be followed separately, eg. counts in  statistics are separated by release group.</p></li>
<li><p>The following are optional lists of parameters for classes which create new particle properties, calculate statistics, or modfiy how the particles move</p></li>
</ul>
</section>
<section id="defaults">
<h2>Defaults<a class="headerlink" href="#defaults" title="Permalink to this headline">¶</a></h2>
<p>All parameters, at top level or lower level, or within lists, are dictionary like, ie. key-value pairs.
A value which is a dictionary is treated as a nested parameter dictionary of key-value pairs.</p>
<p>The values at the ends of any top level dictionary or nested parameter dictionary
have specified default values associated with their key, which are used if none is provide by the user.</p>
</section>
<section id="checking">
<h2>Checking<a class="headerlink" href="#checking" title="Permalink to this headline">¶</a></h2>
<p>Any user given values are checked to ensure they are the required data type,  are in the range of acceptable values, etc.
For a few keys, a value must be supplied by the user (eg. input_dir of hindcast files). If these are not given an “is_required error” will be generated.</p>
<p>The user is warned of any unexpected keys found within the parameters, ie those not in the default parameter dictionary.</p>
<p>Full details of defaults are given in  <a class="reference internal" href="../parameter_ref/parameter_ref_toc.html#parameter-details"><span class="std std-ref">Parameter details</span></a></p>
</section>
<section id="class-name-parameter">
<h2>class_name parameter<a class="headerlink" href="#class-name-parameter" title="Permalink to this headline">¶</a></h2>
<p>To give flexibility the classes which  make up the particle tracking computational pipeline
are added via their class_name parameter given as a string, eg.</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;class_name&quot;:</span> <span class="pre">&quot;oceantracker.particle_release_groups.polygon_release.PolygonRelease&quot;</span></code></p>
<p>which is used to import the class. This enables users to freely add the capabilities needed.
In this case there might be releases from several different polygons, each with their individual release rates etc,
each added by their parameters in the particle_release_groups list.</p>
<p>Adding  via a string also allows users to create their own variants of the classes,
which inherit most of their functionality from their parent class, but are  tweaked to have behaviours or functionality
to suit the user. These new particle properties are added to the computational pipeline with their parameters.
Provided they are in the current working dir or accessible via the python path,
these user added classes, along with all other classes, are imported using their class_name string.</p>
<p>An example below is the class which adds the ‘AgeDecay’ particle property. The important method is its update()
which calculates the current amount of the property remaining based on the core particle property ‘age’ and exponential decay.
Age is part of the same computational  pipeline as AgeDecay, like a particle’s location property ‘x’,  another core property.
Core particle properties are updated before those added by the user.</p>
<p>The mechanics of accessing AgeDecay’s data and writing it to the output file are done with methods inherited from the
ParticleProperty base class <code class="docutils literal notranslate"><span class="pre">oceantracker.particle_properties._base_properties.ParticleProperty</span></code>,
all overseen by the core ParticleGroupManager class.</p>
<p>Once the ‘AgeDecay’ class is imported, its parameters are merged with the defaults, it is then initilaized and added to
the computational pipeline by the ParticleGroupManager. Then it will automatically:</p>
<ul class="simple">
<li><p>be updated each time step</p></li>
<li><p>be written to the output file along with ‘x’ and other properties (unless its ‘write’ parameter is False)</p></li>
<li><p>if requested, have statistics such as heat maps automatically calculated and written to output files on the fly</p></li>
<li><p>its values can be access by other particle properties, which may depend on it (eg. age_decay particle property depends on the ‘age’ property)</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">../../../oceantracker/particle_properties/age_decay.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oceantracker.particle_properties._base_properties</span> <span class="kn">import</span> <span class="n">ParticleProperty</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">oceantracker.util.parameter_checking</span> <span class="kn">import</span> <span class="n">ParamDictValueChecker</span> <span class="k">as</span> <span class="n">PVC</span>
<span class="k">class</span> <span class="nc">AgeDecay</span><span class="p">(</span><span class="n">ParticleProperty</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_default_params</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">PVC</span><span class="p">(</span><span class="s1">&#39;age_decay&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">,</span>
                                 <span class="s1">&#39;doc_str&#39;</span><span class="p">:</span> <span class="n">PVC</span><span class="p">(</span> <span class="s1">&#39;decaying particle based on age&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                 <span class="s1">&#39;initial_value&#39;</span><span class="p">:</span> <span class="n">PVC</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                                 <span class="s1">&#39;decay_time_scale&#39;</span><span class="p">:</span> <span class="n">PVC</span><span class="p">(</span> <span class="mf">1.</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">,</span> <span class="nb">float</span><span class="p">)})</span>

    <span class="k">def</span> <span class="nf">check_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_class_required_fields_properties_grid_vars_and_3D</span><span class="p">(</span><span class="n">required_props</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">msg_list</span>


    <span class="k">def</span> <span class="nf">initial_value_at_birth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_part_IDs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;initial_value&#39;</span><span class="p">],</span> <span class="n">new_part_IDs</span><span class="p">)</span> <span class="c1"># sets this properties values</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">active</span><span class="p">):</span>
        <span class="c1"># update decay prop each time step</span>
        <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_info</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="s1">&#39;particle_properties&#39;</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;initial_value&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;decay_time_scale&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">active</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="running_ocean_tracker.html" title="Previous document">Running OceanTracker</a>
        </li>
        <li>
          <a href="../parameter_ref/parameter_ref_toc.html" title="Next document">Parameter details</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, R. Vennell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/info/users_guide/parameters_overview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>